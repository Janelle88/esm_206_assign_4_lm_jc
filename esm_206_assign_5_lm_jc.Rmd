---
title: "Pacific Giant Salamanders in Mack Creek"
author: "Janelle Christensen & Lauren Manzo"
date: "12/04/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE)
# -------------------------
# Attach necessary packages
# -------------------------
library(tidyverse)
library(janitor)
library(directlabels)
library(kableExtra)
library(ggrepel)
library(plotly)
library(gridExtra)
library(grid)
library(effsize)

```

```{r}
# -----------------
# Read in csv file
# -----------------

salamander_df <- read_csv("mack_creek_vertebrates.csv") %>%
# Read in lobster_abundance_sbc_lter,csv
# and assign it to an object. 
# Pipe to move to the next step.
  clean_names() %>% 
# Simplify names to contain only _, character, 
# numbers, and letters.
# Pipe to move to the next step.
  filter(species %in% c("DITE"))
# Use filter so we only see salamander data.

```

### Introduction

...

Figure 1. Aquatic Vertebrate Population Study in Mack Creek, Andrews Experimental Forest
![Aquatic Vertebrate Population Study in Mack Creek, Andrews Experimental Forest](map.png)
Credit: [EDI Data Portal](https://portal.edirepository.org/nis/mapbrowse?scope=knb-lter-and&identifier=4027&revision=12)

Figure 2. Pacific Giant Salamander
![Pacific Giant Salamander](pacificgiantsalamader.jpg)
Credit: [Jeffrey Marsten Wikimedia](https://commons.wikimedia.org/wiki/File:Dicamptodon_tenebrosus_2.JPG)

### Data and Methods

### Results

##### 1. Observed annual salamander counts in old growth and clear cut sections of Mack Creek

```{r}
# --------------------
# Create Graph A data
# --------------------

salamander_count <- salamander_df %>% 
# Call the data and assign it to an object.
# Pipe to move to the next step.
  group_by(section, year) %>% 
# Group receiving section and year by collapsing 
# multiple data points into a single row,
# based on what is summarized in the next step.
# Pipe to move to the next step.
  select(section, year, entity) %>% 
# Select specific columns to keep in the data frame.
  summarize("total" = sum(entity)) %>% 
# Summarize (new column = whatever you're doing(metric)).
    mutate("section_name" = ifelse(section == "OG", "old growth",
                              ifelse(section == "CC", "clear cut")))
# Create a new column containing non-abbreviated section names.
  
```

```{r, fig.cap="Figure 3: Annual salamander counts observed from 1993 - 2017 in two sections of Mack Creek that were either old growth (dark green) or clear cut (light green) in the Andrews Experimental Forest. Data: Andrews Forest LTER"}
# ---------------
# Create Graph A
# ---------------

ggplot(data = salamander_count, aes(x = year, y = total, group = section)) + 
# Create a graph and call out data to be used,
# including what the x and y variables are.
# To create individual lines by section, need group = section.
  geom_line(aes(color = section_name), size = 1.2) +
# Color lines by section and specify line size.
  labs(color = "Sections of Mack Creek",
       x = "Year",
       y = "Annual salamander counts") + 
# Use color to create the legend title and create 
# labels for the x and y axes and title.
  theme_light() +
# Call out a theme to tweak the display of an existing theme.
  geom_dl(aes(label = section_name), 
          method = list(dl.combine("last.points"), 
                        cex = .8)) + 
# Use geom_dl for direct labels on the lines, cex is font size, 
# method needs to be written like this.
  theme(legend.position = c(0.19, 0.837)) + 
# Manually reposition legend.
  scale_x_continuous(expand = c(0,0),
                     limits = c(1993,2025)) + 
# Needed to expand limits for years.
  scale_y_continuous(expand = c(0,0),
                     limits = c(0, 550)) +
# Needed to expand limits for section counts.
  scale_color_manual(breaks = c("old growth", "clear cut"), 
                     values = c("darkseagreen3", "darkslategray")) 
# Manually change line colors in graph based on 
# whether a section is old growth or clear cut.

```

#### B

Table of 2017 salamander counts by channel classification (pool, cascades and side-channel) in old growth (OG) and clear cut (CC) sections of Mack Creek.

```{r}
channel_class_df <- salamander_df %>% 
  filter(section %in% c("CC", "OG")) %>% 
  #filter data for only Clear Cut and Old Growth
  filter(unittype %in% c("C", "SC", "P")) %>%
  #filter for only pools, side channels and channel
  mutate("creek_area" = ifelse(unittype == "C", "Channel",
                        ifelse(unittype == "SC", "Side-Channel", "Pool"))) %>%
  # make names nicer for table
  count(section, creek_area)
# count the data for salamanders in these variables

channel_class_table <- channel_class_df %>% 
  pivot_wider(names_from = section,
              values_from = n) %>%
  #pivot wider to make a contingency table, long format bad for this
  adorn_percentages(denominator = "row") %>% 
  # denominator = row to get pct on row
  adorn_pct_formatting(digits = 1) %>% 
  # rounding the decimal places
  adorn_ns(position = "front")
# numbers in front of percentages

channel_class_table %>% 
  kable(col.names = c("Area of Creek",
                      "Clear Cut", 
                      "Old Growth")) %>% 
  #column names - can't change row names in kable
  kable_styling(bootstrap_options = "striped",
                full_width = F,
                position = "center") %>% 
  # full width (F), centered table
  add_header_above(bold = TRUE,
                   line = TRUE, 
                   c("Salamanders Observed in Mack Creek" = 3))
# header number has to match number of columns
```

#### C

Using the 2017 counts found in Results B above, answer: is there a significant difference in where in the channel Pacific giant salamanders are located (pool, cascade or side channel) between the two sections (old growth and clear cut)?

```{r}

```

#### D

Compare weights of Pacific giant salamanders in clear cut and old growth forest sections of the creek in 2017.

To do:
- Histogram
- qqplot

```{r}
# --------------------
# Create Graph D data
# --------------------

salamander_weight <- salamander_df %>%  
#Call out data and assign it to an object.
#Pipe to move to the next step.
  filter(year %in% c("2017")) %>%
# Filter out the observations during the year 2017.
  group_by(section, year) %>%
# Group receiving section and year by collapsing
# multiple data points into a single row.
# Pipe to move to the next step.
  select(year, section, weight) %>%
# Select specific columns to keep in the data frame.
  mutate("section_name" = ifelse(section == "OG", "old growth",
                              ifelse(section == "CC", "clear cut")))
#Create a new column containing non-abbreviated section names.

salamander_weight_av <- salamander_weight %>% 
#Call out data and assign it to an object.
#Pipe to move to the next step.
  group_by(section, year) %>%
# Group receiving section and year by collapsing
# multiple data points into a single row.
# Pipe to move to the next step.
  summarize(weight_av = mean(weight, na.rm = TRUE)) %>% 
# Summarize (new column = whatever you're doing(metric)).
  filter(year %in% c(2017))
# Filter out the observations during the year 2017.

```

```{r, fig.cap="Figure 6: Salamander weight in old growth and clear cut areas in Mack Creek in 2017 and kernal density for mean salamandar weight in old growth areas (dark green) and in clear cut areas (light green) in 2017. The means are shown as dashed lines. Data: Andrews Forest LTER"}
# ---------------
# Create Graph D 
# ---------------

ggplot(data = salamander_weight, aes(x = weight,
# Create a graph and call out data to be used,
# including what the x variable is.
                                    fill = as.character(section),
                                    color = as.character(section))) +
# Using as.character allows me to group them by year.
  geom_density(alpha = 0.3) +
  scale_fill_manual(breaks = c("old growth", 
                               "clear cut"), 
                    values = c("darkslategray", 
                               "darkseagreen3")) +
# Specify colors for the fill of the curves.
  scale_color_manual(breaks = c("old growth", 
                                "clear cut"), 
                     values = c("darkslategray", 
                                "darkseagreen3")) +
# Specify colors for the lines.
  theme_minimal() +
# Call out a theme to tweak the display of an existing theme.
  theme(legend.position = "none") +  
# Don't want a legend, label manually.
  annotate(
     geom = "curve",
# Use geom="curve" for curved line, geom="segment" for straight.
     x = 4,
# Line start.
    y = 0.101,
# Line start.
     xend = 14,
# Line end.
     yend = 0.1125,
# Line end.
     curvature = .2,
# Level of curve.
     color = "darkseagreen3") +
# Values entered manually for where I want lines to begin and end.
   annotate(geom = "text",
            x = 14.55,
# Where my text will be.
            y = .113,
# Where my text will be.
           label = "clear cut",
           hjust = "left",
           color = "darkseagreen3") +
# Annotation for 2018.
   annotate(
     geom = "curve",
# Use geom="curve" for curved line, geom="segment" for straight.
     x = 12.5,
# Start of line.
     y = 0.03,
# Start of line.
     xend = 25,
# End of line.
     yend = 0.045,
# End of line.
    curvature = .2,
# Level of curve.
     color = "darkslategray") +
# Values entered manually for where I want the lines to begin and end.
   annotate(geom = "text",
            x = 26,
# Where my label will sit.
            y = 0.045,
# Where my label will sit.
            label = "old growth",
            hjust = "left",
color = "darkslategray") +
# Annotation for 2012.
   geom_vline(xintercept = 6.583333,
              color = "darkslategray",
              linetype = "dashed",
              size = 0.5) +
   geom_vline(xintercept = 7.775870,
              color = "darkseagreen3",
             linetype = "dashed",
              size = 0.5) +
# Means taken from lobster_size_av dataframe.
# Using vline allows me to draw a vertical line of the mean.
  labs(x = "Salamander weight (grams)",
       y = "Kernel density")
# Create labels for the x and y axes and title.
# Create caption below the graph and edit font size and style.


```

#### E

Compare weights of Pacific giant salamanders in pools, cascades and side-channels of Mack Creek in 2017.

To do:
- Exclude from final data, but visually explore
  - Histogram
  - qqplot

```{r}

```


### Summary

- Bullet points

### References

^1^Gregory S. V. 2016. Aquatic Vertebrate Population Study in Mack Creek, Andrews Experimental Forest, 1987 to present. Environmental Data Initiative. https://doi.org/10.6073/pasta/5de64af9c11579266ef20da2ff32f702. Dataset accessed 11/19/2019.
